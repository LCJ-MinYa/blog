---
title: 微信小程序日常技巧
date: 2020-4-10 17:52:45
categories: js
tags:
- 前端
- javascript
- 微信小程序
---

## 安卓更新微信后小程序字体不居中
* 开发者工具表现正常，安卓真机老版本微信正常显示，升级后文本显示偏上
* 所有有问题得地方都为line-height来设置垂直居中
```css
/* 所有需要用到文本居中的地方都是用flex来解决 */
.text-center{
    display: flex;
    align-items: center;
    justify-content: center;
}
```

## scroll-view无法触发bindscrolltolower上拉加载
* 如果`scroll-view`在页面最顶层
```css
page{
    height: 100%;
}
.scroll-view-class{
    height: 100%;
}
```

* 如果`scroll-view`作为子组件被嵌套多层（或者包含第三方UI框架），此时没办法保证所有父节点都是`height: 100%;`
```js
//已知明确高度(假定页面其他元素明确高度100px或者200rpx两种类型)
wx.getSystemInfo({
    success:(res=>{
        let otherHeight = 200 / 750 * res.windowWidth;
        this.scrollH = (res.windowHeight - otherHeight) + 'px';
    })
});

//未知高度，通过createSelectorQuery方法动态获取scroll-view高度（如果scroll-view内是数据请求的，需要在获取到数据渲染页面之后再设置高度）
onReady(){
    let query = wx.createSelectorQuery();
    query.select('.scroll-box').boundingClientRect(rect=>{
        console.log(rect);
        this.scrollHeight = rect.height;
        console.log(this.scrollHeight);
    }).exec();
}
```

## 两个请求同时发出，都未登录同时跳转登录页面处理方法
* 一般用于请求中登录失效，跳转到登录页（某个页面同时发出两个请求）
```js
//防止多次跳转
let pages = getCurrentPages();
if(pages[pages.length - 1].route != 'pages/auth/login'){
    if(wepy.$instance.globalData.login){
        return;
    }
    wepy.$instance.globalData.login = true;
    wx.navigateTo({
        url: '/pages/auth/login',
        complete: (result)=>{
            wepy.$instance.globalData.login = false;
        }
    });
}
```

## wepy报错
* 报错信息`unexpected attribute name, near .sync`(包括`.once`)
```js
//问题一,是否有components，并且必须未=号
components = {

}

//问题二,组件引入方式(不能包含.wpy后缀)
import CollectProduct from '../../components/list/collectProduct';

//问题三,组件引入写法必须一直（我遇到的问题就是这个）
components = {
    collectProduct: CollectProduct,
    shopItem: ShopItem,
    productRefreshList: ProductRefreshList,
    shopRefreshList: ShopRefreshList,
}
/*
components = {
    collectProduct: CollectProduct,
    shopItem: ShopItem,
    ProductRefreshList: ProductRefreshList,
    ShopRefreshList: ShopRefreshList,
}
1.大小写不一直，报错

components = {
    collectProduct: CollectProduct,
    shopItem: ShopItem,
    productRefreshList,
    shopRefreshList,
}
2.简写，报错
*/
```